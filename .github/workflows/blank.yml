name: Protect Python PR

on:
  pull_request:
    branches: [ "main" ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  checkout:
    runs-on: ubuntu-latest
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v3
  build:
    runs-on: ubuntu-latest
    steps:
      # Install python on compute
      - name: Install Python
        uses: actions/setup-python@v2
        with:
          python-version: "3.8"

      # install third-party libs
      - name: Install Testing and Formatting Libs
        run: |
          pip install black
          pip install pytest
          pip install pytest-cov
          echo Installed black, pytest and pytest-cov libs...

      - name: Check Formatting With Black
        run: black --check ./

      - name: Set status check
        id: status-check
        run: echo "::set-output name=status::$(black --check ./src && echo 'pass' || echo 'fail')"

      - name: Report status (check Fail)
        if: ${{ needs.status-check.outputs.status == 'fail' }}
        run: echo "Black formatting check failed. Please format your code using Black."

      - name: Report status (check Pass)
        if: ${{ needs.status-check.outputs.status == 'pass' }}
        run: echo "Black formatting check passed."
